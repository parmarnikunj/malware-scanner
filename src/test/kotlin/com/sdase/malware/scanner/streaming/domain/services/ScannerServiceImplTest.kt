package com.sdase.malware.scanner.streaming.domain.services

import com.sdase.malware.scanner.streaming.domain.model.StateEnum
import com.sdase.malware.scanner.streaming.domain.services.Mothers.Companion.defaultCheckEvent
import io.mockk.every
import io.mockk.mockk
import io.mockk.verify
import org.assertj.core.api.Assertions.assertThat
import org.junit.jupiter.api.Test

class ScannerServiceImplTest {
    private val ibanService = mockk<IBANService>()
    private val scannerService = ScannerServiceImpl(ibanService)
    @Test
    fun `scan shall produce CheckResultEvent`() {

        every { ibanService.isBlacklisted(any()) } returns false


        val checkEvent = defaultCheckEvent()
        val checkResultEvent = scannerService.scan(checkEvent)

        verify { ibanService.isBlacklisted(any()) }

        assertThat(checkResultEvent).isNotNull
        assertThat(checkResultEvent.name).isEqualTo(checkEvent.url)
        assertThat(checkResultEvent.stateEnum).isEqualTo(StateEnum.ERROR)
    }
}