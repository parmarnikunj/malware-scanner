package com.sdase.malware.scanner.streaming.domain.connector

import org.springframework.core.io.InputStreamResource
import org.springframework.core.io.Resource
import org.springframework.core.io.buffer.DataBuffer
import org.springframework.core.io.buffer.DataBufferUtils
import org.springframework.stereotype.Service
import org.springframework.web.reactive.function.client.WebClient
import java.io.File
import java.net.URI
import java.net.URL
import java.nio.file.Files
import java.nio.file.Path

@Service
class DocumentConnectorService(
    private val webClient: WebClient
) {
    fun getDocument(uri: String): Path {
        val file = File(uri.split("/").last())
        if(file.exists()) file.delete()
        file.createNewFile()

        val flux = webClient
            .get()
            .uri(uri)
            .retrieve()
            .bodyToFlux(DataBuffer::class.java)

        DataBufferUtils.write(flux, file.toPath())
            .block()

        return file.toPath()

    }
}