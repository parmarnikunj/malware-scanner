package com.sdase.malware.scanner.streaming.domain.controller

import com.fasterxml.jackson.databind.ObjectMapper
import com.sdase.malware.scanner.streaming.domain.model.CheckEvent
import org.springframework.kafka.core.KafkaTemplate
import org.springframework.web.bind.annotation.GetMapping
import org.springframework.web.bind.annotation.PathVariable
import org.springframework.web.bind.annotation.PostMapping
import org.springframework.web.bind.annotation.RequestMapping
import org.springframework.web.bind.annotation.RequestParam
import org.springframework.web.bind.annotation.RestController

@RestController
@RequestMapping("/scan")
class ScanController(
    private val kafkaTemplate: KafkaTemplate<String, String>,
    private val objectMapper: ObjectMapper
) {
    @PostMapping("/{documentName}")
    fun postEvent(@PathVariable documentName:String) {
        kafkaTemplate.send(
            "scan_malware",
            objectMapper
                .writeValueAsString(
                    CheckEvent(
                        "http://localhost:8080/documents/$documentName",
                        "pdf")) )
    }
}