package com.sdase.malware.scanner.streaming.domain.services

import com.itextpdf.text.pdf.PdfReader
import com.itextpdf.text.pdf.parser.PdfTextExtractor
import com.sdase.malware.scanner.streaming.domain.model.IBAN
import org.springframework.stereotype.Service
import java.nio.file.Files
import java.nio.file.Path

@Service
class PdfServiceImpl: PdfService {
    override fun findIBAN(document: Path): IBAN {
        val pdfDocument = PdfReader(Files.newInputStream(document))
        val text = StringBuilder()
        val pages = pdfDocument.numberOfPages
        for(i in 1..pages) {
            text.append(PdfTextExtractor.getTextFromPage(pdfDocument, i))
        }
        pdfDocument.close()
        return IBAN(IBAN_REGEX.find(text)!!.value)
    }
    companion object {
        val IBAN_REGEX = """[A-Z]{2}\d{2} (\d{4} ){4}\d{2}""".toRegex()
    }
}